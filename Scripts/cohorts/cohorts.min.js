Cohorts=function(){var a={debug:false};var b={nameSpace:"cohorts",trackEvent:function(a,b,c,e){d.log("GA trackEvent: "+a+", "+b+", "+c+", "+e);if(window["_gaq"]){_gaq.push(["_trackEvent",a,b,c,e])}else{throw" _gaq object not found: It looks like you haven't correctly setup the asynchronous Google Analytics tracking code, and you are using the default GoogleAnalyticsAdapter."}},onInitialize:function(a,b,c){if(a){this.trackEvent(this.nameSpace,b,c+" | Total")}},onEvent:function(a,b,c){this.trackEvent(this.nameSpace,a,b+" | "+c)}};var c=function(){var a="_cohorts";var c=function(a){this.options=d.extend({name:null,cohorts:null,sample:1,storageAdapter:null},a);if(this.options.name===null)throw"A name for this test must be specified";if(this.options.cohorts===null)throw"Cohorts must be specified for this test";if(d.size(a.cohorts)<2)throw"You must specify at least 2 cohorts for a test";if(!this.options.storageAdapter)this.options.storageAdapter=b;this.cohorts=d.keys(this.options.cohorts);this.run()};c.prototype={run:function(){var a=window.location.hash;if(a.indexOf("#")==0)a=a.slice(1,a.length);var b=a.split("&");for(var c=0;c<b.length;c++){var e=b[c].split("=");var f=e[0];var g=e[1];if(this.options.name==f){d.log("Forcing test "+f+" into cohort "+g);this.setCohort(g)}}var h=this.inTest();if(h===null)h=Math.random()<=this.options.sample;if(h){this.setCookie("in_test",1);if(!this.getCohort()){var i=1/d.size(this.options.cohorts);var j=Math.floor(Math.random()/i);var k=d.keys(this.options.cohorts)[j];this.setCohort(k)}else{var k=this.getCohort()}this.options.storageAdapter.onInitialize(h,this.options.name,k);if(this.options.cohorts[k].onChosen)this.options.cohorts[k].onChosen()}else{this.setCookie("in_test",0)}},event:function(a){if(this.inTest())this.options.storageAdapter.onEvent(this.options.name,this.getCohort(),a)},inTest:function(){if(this.getCookie("in_test")==1){return true}else if(this.getCookie("in_test")==0){return false}else{return null}},inCohort:function(a){if(this.inTest()){return this.getCohort()==a}else{return false}},getCohort:function(){if(this.inTest()){return this.getCookie("chosen_cohort")}else{return null}},setCohort:function(a){if(this.cohorts.indexOf(a)==-1){return false}else{this.setCookie("chosen_cohort",a);return true}},setCookie:function(b,c){e.set(a+"_"+this.options.name+"_"+b,c)},getCookie:function(b){return e.get(a+"_"+this.options.name+"_"+b)}};return c}();var d={extend:function(a,b){for(var c in b)a[c]=b[c];return a},size:function(a){var b=0;for(var c in a)b+=1;return b},keys:function(a){var b=[];for(var c in a)b.push(c);return b},log:function(b){if(window["console"]&&a.debug){if(console.log){console.log(b)}else{alert(b)}}}};var e=function(){var a,b,c,d,e={expiresAt:null,path:"/",domain:null,secure:false};a=function(a){var b,c;if(typeof a!=="object"||a===null){b=e}else{b={expiresAt:e.expiresAt,path:e.path,domain:e.domain,secure:e.secure};if(typeof a.expiresAt==="object"&&a.expiresAt instanceof Date){b.expiresAt=a.expiresAt}else if(typeof a.hoursToLive==="number"&&a.hoursToLive!==0){c=new Date;c.setTime(c.getTime()+a.hoursToLive*60*60*1e3);b.expiresAt=c}if(typeof a.path==="string"&&a.path!==""){b.path=a.path}if(typeof a.domain==="string"&&a.domain!==""){b.domain=a.domain}if(a.secure===true){b.secure=a.secure}}return b};b=function(b){b=a(b);return(typeof b.expiresAt==="object"&&b.expiresAt instanceof Date?"; expires="+b.expiresAt.toGMTString():"")+"; path="+b.path+(typeof b.domain==="string"?"; domain="+b.domain:"")+(b.secure===true?"; secure":"")};c=function(){var a={},b,c,d,e,f=document.cookie.split(";"),g;for(b=0;b<f.length;b=b+1){c=f[b].split("=");d=c[0].replace(/^\s*/,"").replace(/\s*$/,"");try{e=decodeURIComponent(c[1])}catch(h){e=c[1]}if(typeof JSON==="object"&&JSON!==null&&typeof JSON.parse==="function"){try{g=e;e=JSON.parse(e)}catch(i){e=g}}a[d]=e}return a};d=function(){};d.prototype.get=function(a){var b,d,e=c();if(typeof a==="string"){b=typeof e[a]!=="undefined"?e[a]:null}else if(typeof a==="object"&&a!==null){b={};for(d in a){if(typeof e[a[d]]!=="undefined"){b[a[d]]=e[a[d]]}else{b[a[d]]=null}}}else{b=e}return b};d.prototype.filter=function(a){var b,d={},e=c();if(typeof a==="string"){a=new RegExp(a)}for(b in e){if(b.match(a)){d[b]=e[b]}}return d};d.prototype.set=function(a,c,d){if(typeof d!=="object"||d===null){d={}}if(typeof c==="undefined"||c===null){c="";d.hoursToLive=-8760}else if(typeof c!=="string"){if(typeof JSON==="object"&&JSON!==null&&typeof JSON.stringify==="function"){c=JSON.stringify(c)}else{throw new Error("cookies.set() received non-string value and could not serialize.")}}var e=b(d);document.cookie=a+"="+encodeURIComponent(c)+e};d.prototype.del=function(a,b){var c={},d;if(typeof b!=="object"||b===null){b={}}if(typeof a==="boolean"&&a===true){c=this.get()}else if(typeof a==="string"){c[a]=true}for(d in c){if(typeof d==="string"&&d!==""){this.set(d,null,b)}}};d.prototype.test=function(){var a=false,b="cT",c="data";this.set(b,c);if(this.get(b)===c){this.del(b);a=true}return a};d.prototype.setOptions=function(b){if(typeof b!=="object"){b=null}e=a(b)};return new d}();return{Test:c,Cookies:e,Options:a}}()